<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN"  "http://ibatis.apache.org/dtd/sql-map-2.dtd">
<!-- 					근태관리 관리자                                       -->
<!--	 << 개정이력(Modification Information) >>    -->
<!--    수정일                    수정자                     수정내용                   	  -->
<!--  =======      =======     =====================    -->
<!-- 2016.09.05.    김태균                      최초생성                   			-->
<!-- Copyright (c) 2016 by DDIT  All right reserved     -->
<sqlMap namespace="attendance">
	<typeAlias alias="memberVO" type="com.groupware.dto.MemberVO" />
	<typeAlias alias="attendanceVO" type="com.groupware.dto.attendance.AttendanceVO" />
	<typeAlias alias="departVO" type="com.groupware.dto.attendance.DepartVO" />
	<typeAlias alias="workStateVO" type="com.groupware.dto.attendance.WorkStateVO" />

	<select id="getAttendanceList" resultClass="attendanceVO">
		SELECT ATT_MEM_NUM, ATT_DATE, DEP_NM, POS_NM, MEM_NM, TO_CHAR(ATT_IN_TIME,'YYYY-MM-DD HH24:MI:SS') AS ATT_IN_TIME, TO_CHAR(ATT_OUT_TIME,'YYYY-MM-DD HH24:MI:SS') AS ATT_OUT_TIME, ATT_WK_ST_CODE, WK_ST_NM
		FROM ATTENDANCE,MEMBER,DEPARTMENT,POSITION,WORK_STATE
		WHERE ATTENDANCE.ATT_MEM_NUM=MEMBER.MEM_NUM 
		AND 
			MEMBER.MEM_DEP_CODE=DEPARTMENT.DEP_CODE
		AND
			ATTENDANCE.ATT_WK_ST_CODE = WORK_STATE.WK_ST_CODE
		AND 
			MEMBER.MEM_POS_CODE=POSITION.POS_CODE
		ORDER BY ATT_DATE DESC, DEP_NM ASC, MEM_NM ASC 
	</select>
	
	<select id="getAttendanceInformation" resultClass="attendanceVO" parameterClass="map">
		SELECT ATT_MEM_NUM, ATT_DATE, DEP_NM, POS_NM, MEM_NM, TO_CHAR(ATT_IN_TIME,'YYYY-MM-DD HH24:MI:SS') AS ATT_IN_TIME, TO_CHAR(ATT_OUT_TIME,'YYYY-MM-DD HH24:MI:SS') AS ATT_OUT_TIME, ATT_WK_ST_CODE, WK_ST_NM
		FROM ATTENDANCE,MEMBER,DEPARTMENT,POSITION,WORK_STATE
		WHERE ATTENDANCE.ATT_MEM_NUM=MEMBER.MEM_NUM
		AND 
			MEMBER.MEM_DEP_CODE=DEPARTMENT.DEP_CODE
		AND 
			ATTENDANCE.ATT_WK_ST_CODE = WORK_STATE.WK_ST_CODE
		AND 
			MEMBER.MEM_POS_CODE=POSITION.POS_CODE
		AND
			ATT_DATE=TO_DATE(#att_date#,'YY/MM/DD')
		AND
			ATT_MEM_NUM=#att_mem_num#
	</select>
	
	<update id="attendanceUpdate" parameterClass="map" >
		UPDATE ATTENDANCE
		SET	ATT_WK_ST_CODE = #att_wk_st_code#
		WHERE 
			ATT_DATE=TO_DATE(#att_date#,'YY/MM/DD')
		AND
			ATT_MEM_NUM=#att_mem_num#
	</update>
	
	<update id="attendanceCheckIn" parameterClass="str">
		INSERT INTO ATTENDANCE(ATT_DATE, ATT_MEM_NUM, ATT_IN_TIME, ATT_WK_ST_CODE)
					   VALUES (TO_CHAR(SYSDATE, 'YYMMDD'), #mem_num#, SYSDATE , 1)
	</update>
	
	<update id="attendanceCheckOut" parameterClass="str">
		UPDATE ATTENDANCE
		SET ATT_OUT_TIME = SYSDATE
		WHERE ATT_MEM_NUM = #mem_num#
		AND ATT_DATE = TO_CHAR(SYSDATE, 'YYMMDD')
	</update>
	
	<select id="getDepartList" resultClass="departVO">
		SELECT *
		FROM DEPARTMENT
		ORDER BY DEP_CODE ASC
	</select>
	
	<select id="getWorkStateList" resultClass="workStateVO">
		SELECT *
		FROM WORK_STATE
		ORDER BY WK_ST_CODE ASC
	</select>
	
	<select id="getAttDefault" parameterClass="map" resultClass="attendanceVO">
		SELECT ATT_MEM_NUM, ATT_DATE, DEP_NM, POS_NM, MEM_NM, TO_CHAR(ATT_IN_TIME,'YYYY-MM-DD HH24:MI:SS') AS ATT_IN_TIME, TO_CHAR(ATT_OUT_TIME,'YYYY-MM-DD HH24:MI:SS') AS ATT_OUT_TIME, ATT_WK_ST_CODE, WK_ST_NM
		FROM ATTENDANCE,MEMBER,DEPARTMENT,POSITION,WORK_STATE
		WHERE ATTENDANCE.ATT_MEM_NUM=MEMBER.MEM_NUM
		AND ATTENDANCE.ATT_WK_ST_CODE = WORK_STATE.WK_ST_CODE
		AND MEMBER.MEM_DEP_CODE=DEPARTMENT.DEP_CODE
		AND MEMBER.MEM_POS_CODE=POSITION.POS_CODE
		AND TO_DATE(ATT_DATE,'YYMMDD') <![CDATA[>]]>= TO_DATE(#startDate#,'YYYY/MM/DD')
		AND TO_DATE(ATT_DATE,'YYMMDD') <![CDATA[<]]>= TO_DATE(#endDate#,'YYYY/MM/DD')
		ORDER BY ATT_DATE DESC, DEP_NM ASC, MEM_NM ASC
	</select>
	<select id="getAttWithState" parameterClass="map" resultClass="attendanceVO">
		SELECT ATT_MEM_NUM, ATT_DATE, DEP_NM, POS_NM, MEM_NM, TO_CHAR(ATT_IN_TIME,'YYYY-MM-DD HH24:MI:SS') AS ATT_IN_TIME, TO_CHAR(ATT_OUT_TIME,'YYYY-MM-DD HH24:MI:SS') AS ATT_OUT_TIME, ATT_WK_ST_CODE, WK_ST_NM
		FROM ATTENDANCE,MEMBER,DEPARTMENT,POSITION,WORK_STATE
		WHERE ATTENDANCE.ATT_MEM_NUM=MEMBER.MEM_NUM
		AND ATTENDANCE.ATT_WK_ST_CODE = WORK_STATE.WK_ST_CODE
		AND MEMBER.MEM_DEP_CODE=DEPARTMENT.DEP_CODE
		AND MEMBER.MEM_POS_CODE=POSITION.POS_CODE
		AND TO_DATE(ATT_DATE,'YYMMDD') <![CDATA[>]]>= TO_DATE(#startDate#,'YYYY/MM/DD')
		AND TO_DATE(ATT_DATE,'YYMMDD') <![CDATA[<]]>= TO_DATE(#endDate#,'YYYY/MM/DD')
		AND ATT_WK_ST_CODE = #state#
		ORDER BY ATT_DATE DESC, DEP_NM ASC, MEM_NM ASC
	</select>
	<select id="getAttWithDepart" parameterClass="map" resultClass="attendanceVO">
		SELECT ATT_MEM_NUM, ATT_DATE, DEP_NM, POS_NM, MEM_NM, TO_CHAR(ATT_IN_TIME,'YYYY-MM-DD HH24:MI:SS') AS ATT_IN_TIME, TO_CHAR(ATT_OUT_TIME,'YYYY-MM-DD HH24:MI:SS') AS ATT_OUT_TIME, ATT_WK_ST_CODE, WK_ST_NM
		FROM ATTENDANCE,MEMBER,DEPARTMENT,POSITION,WORK_STATE
		WHERE ATTENDANCE.ATT_MEM_NUM=MEMBER.MEM_NUM
		AND ATTENDANCE.ATT_WK_ST_CODE = WORK_STATE.WK_ST_CODE
		AND MEMBER.MEM_DEP_CODE=DEPARTMENT.DEP_CODE
		AND MEMBER.MEM_POS_CODE=POSITION.POS_CODE
		AND TO_DATE(ATT_DATE,'YYMMDD') <![CDATA[>]]>= TO_DATE(#startDate#,'YYYY/MM/DD')
		AND TO_DATE(ATT_DATE,'YYMMDD') <![CDATA[<]]>= TO_DATE(#endDate#,'YYYY/MM/DD')
		AND DEP_NM = #depart#
		ORDER BY ATT_DATE DESC, DEP_NM ASC, MEM_NM ASC
	</select>
	<select id="getAttWithDepartState" parameterClass="map" resultClass="attendanceVO">
		SELECT ATT_MEM_NUM, ATT_DATE, DEP_NM, POS_NM, MEM_NM, TO_CHAR(ATT_IN_TIME,'YYYY-MM-DD HH24:MI:SS') AS ATT_IN_TIME, TO_CHAR(ATT_OUT_TIME,'YYYY-MM-DD HH24:MI:SS') AS ATT_OUT_TIME, ATT_WK_ST_CODE, WK_ST_NM
		FROM ATTENDANCE,MEMBER,DEPARTMENT,POSITION,WORK_STATE
		WHERE ATTENDANCE.ATT_MEM_NUM=MEMBER.MEM_NUM
		AND ATTENDANCE.ATT_WK_ST_CODE = WORK_STATE.WK_ST_CODE 
		AND MEMBER.MEM_DEP_CODE=DEPARTMENT.DEP_CODE
		AND MEMBER.MEM_POS_CODE=POSITION.POS_CODE
		AND TO_DATE(ATT_DATE,'YYMMDD') <![CDATA[>]]>= TO_DATE(#startDate#,'YYYY/MM/DD')
		AND TO_DATE(ATT_DATE,'YYMMDD') <![CDATA[<]]>= TO_DATE(#endDate#,'YYYY/MM/DD')
		AND DEP_NM = #depart#
		AND ATT_WK_ST_CODE = #state#
		ORDER BY ATT_DATE DESC, DEP_NM ASC, MEM_NM ASC
	</select>
	<select id="getAttWithName" parameterClass="map" resultClass="attendanceVO">
		SELECT ATT_MEM_NUM, ATT_DATE, DEP_NM, POS_NM, MEM_NM, TO_CHAR(ATT_IN_TIME,'YYYY-MM-DD HH24:MI:SS') AS ATT_IN_TIME, TO_CHAR(ATT_OUT_TIME,'YYYY-MM-DD HH24:MI:SS') AS ATT_OUT_TIME, ATT_WK_ST_CODE, WK_ST_NM
		FROM ATTENDANCE,MEMBER,DEPARTMENT,POSITION,WORK_STATE
		WHERE ATTENDANCE.ATT_MEM_NUM=MEMBER.MEM_NUM
		AND ATTENDANCE.ATT_WK_ST_CODE = WORK_STATE.WK_ST_CODE
		AND MEMBER.MEM_DEP_CODE=DEPARTMENT.DEP_CODE
		AND MEMBER.MEM_POS_CODE=POSITION.POS_CODE
		AND TO_DATE(ATT_DATE,'YYMMDD') <![CDATA[>]]>= TO_DATE(#startDate#,'YYYY/MM/DD')
		AND TO_DATE(ATT_DATE,'YYMMDD') <![CDATA[<]]>= TO_DATE(#endDate#,'YYYY/MM/DD')
		AND MEM_NM LIKE '%'||#name#||'%'
		ORDER BY ATT_DATE DESC, DEP_NM ASC, MEM_NM ASC
	</select>
	<select id="getAttWithNameState" parameterClass="map" resultClass="attendanceVO">
		SELECT ATT_MEM_NUM, ATT_DATE, DEP_NM, POS_NM, MEM_NM, TO_CHAR(ATT_IN_TIME,'YYYY-MM-DD HH24:MI:SS') AS ATT_IN_TIME, TO_CHAR(ATT_OUT_TIME,'YYYY-MM-DD HH24:MI:SS') AS ATT_OUT_TIME, ATT_WK_ST_CODE, WK_ST_NM
		FROM ATTENDANCE,MEMBER,DEPARTMENT,POSITION,WORK_STATE
		WHERE ATTENDANCE.ATT_MEM_NUM=MEMBER.MEM_NUM
		AND ATTENDANCE.ATT_WK_ST_CODE = WORK_STATE.WK_ST_CODE
		AND MEMBER.MEM_DEP_CODE=DEPARTMENT.DEP_CODE
		AND MEMBER.MEM_POS_CODE=POSITION.POS_CODE
		AND TO_DATE(ATT_DATE,'YYMMDD') <![CDATA[>]]>= TO_DATE(#startDate#,'YYYY/MM/DD')
		AND TO_DATE(ATT_DATE,'YYMMDD') <![CDATA[<]]>= TO_DATE(#endDate#,'YYYY/MM/DD')
		AND MEM_NM LIKE '%'||#name#||'%'
		AND ATT_WK_ST_CODE = #state#
		ORDER BY ATT_DATE DESC, DEP_NM ASC, MEM_NM ASC
	</select>
	<select id="getAttWithNameDepart" parameterClass="map" resultClass="attendanceVO">
		SELECT ATT_MEM_NUM, ATT_DATE, DEP_NM, POS_NM, MEM_NM, TO_CHAR(ATT_IN_TIME,'YYYY-MM-DD HH24:MI:SS') AS ATT_IN_TIME, TO_CHAR(ATT_OUT_TIME,'YYYY-MM-DD HH24:MI:SS') AS ATT_OUT_TIME, ATT_WK_ST_CODE, WK_ST_NM
		FROM ATTENDANCE,MEMBER,DEPARTMENT,POSITION,WORK_STATE
		WHERE ATTENDANCE.ATT_MEM_NUM=MEMBER.MEM_NUM
		AND ATTENDANCE.ATT_WK_ST_CODE = WORK_STATE.WK_ST_CODE
		AND MEMBER.MEM_DEP_CODE=DEPARTMENT.DEP_CODE
		AND MEMBER.MEM_POS_CODE=POSITION.POS_CODE
		AND TO_DATE(ATT_DATE,'YYMMDD') <![CDATA[>]]>= TO_DATE(#startDate#,'YYYY/MM/DD')
		AND TO_DATE(ATT_DATE,'YYMMDD') <![CDATA[<]]>= TO_DATE(#endDate#,'YYYY/MM/DD')
		AND MEM_NM LIKE '%'||#name#||'%'
		AND DEP_NM = #depart#
		ORDER BY ATT_DATE DESC, DEP_NM ASC, MEM_NM ASC
	</select>
		<select id="getAttWithNameDepartState" parameterClass="map" resultClass="attendanceVO">
		SELECT ATT_MEM_NUM, ATT_DATE, DEP_NM, POS_NM, MEM_NM, TO_CHAR(ATT_IN_TIME,'YYYY-MM-DD HH24:MI:SS') AS ATT_IN_TIME, TO_CHAR(ATT_OUT_TIME,'YYYY-MM-DD HH24:MI:SS') AS ATT_OUT_TIME, ATT_WK_ST_CODE, WK_ST_NM
		FROM ATTENDANCE,MEMBER,DEPARTMENT,POSITION,WORK_STATE
		WHERE ATTENDANCE.ATT_MEM_NUM=MEMBER.MEM_NUM 
		AND ATTENDANCE.ATT_WK_ST_CODE = WORK_STATE.WK_ST_CODE
		AND MEMBER.MEM_DEP_CODE=DEPARTMENT.DEP_CODE
		AND MEMBER.MEM_POS_CODE=POSITION.POS_CODE
		AND TO_DATE(ATT_DATE,'YYMMDD') <![CDATA[>]]>= TO_DATE(#startDate#,'YYYY/MM/DD')
		AND TO_DATE(ATT_DATE,'YYMMDD') <![CDATA[<]]>= TO_DATE(#endDate#,'YYYY/MM/DD')
		AND MEM_NM LIKE '%'||#name#||'%'
		AND DEP_NM = #depart#
		AND ATT_WK_ST_CODE = #state#
		ORDER BY ATT_DATE DESC, DEP_NM ASC, MEM_NM ASC
	</select>	
		
</sqlMap>